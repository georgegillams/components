ARG NODE_VERSION=16.13.1-alpine
FROM node:${NODE_VERSION}

RUN mkdir /opt/app
WORKDIR /opt/app

COPY . .
RUN PUPPETEER_SKIP_CHROMIUM_DOWNLOAD=true yarn install --frozen-lockfile 
RUN yarn build

# Remove dependencies we don't need in prod:
RUN rm -rf node_modules
RUN yarn cache clean --all
RUN PUPPETEER_SKIP_CHROMIUM_DOWNLOAD=true yarn install --frozen-lockfile --production

CMD ["yarn", "prod"]
